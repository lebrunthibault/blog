[{"content":["This","is","technical","documentation","for","my","Protocol0","Ableton","control","surface","script.","Context","and","goals","on","the","GitHub","readme.","Some","global","remote","scripting","tips","in","this","google","doc","This","doc","is","here","to","shed","some","light","on","the","script’s","object","model,","a","few","techniques","I’ve","set","up","and","the","tools","I’m","using","for","development.","It","goes","from","global","discussion","on","remote","scripting","concepts","/","problems","to","tiny","details","about","the","script","but","is","not","a","full","technical","documentation.","Please","read","the","GitHub","readme","first.","NB",":","This","script","is","a","selected_track/clip/scene_control","kindof","script.","Actions","dispatched","after","moving","knobs","always","apply","to","what","is","selected","in","the","set.","I’ve","decided","to","start","with","an","explanation","of","the","most","complex","stuff","of","my","object","model",":","tracks.","What","are","the","different","track","objects,","and","how","do","I","generate","them","at","script","initialization","and","when","the","LOM","changes.","Object","Model","I’ve","wrapped","most","of","the","Live","objects","I’m","using","in","my","own","classes","(tracks,","clip_slots,","clips,","devices,","parameters..",").","The","most","complex","part","is","the","handling","of","tracks","(not","surprisingly).","Track","Classes","TLDR",":","A","Live.Track.Track","is","mapped","to","a","SimpleTrack","A","SimpleTrack","that","is","also","a","group","track","is","mapped","to","an","AbstractGroupTrack","allowing","seamless","manipulation","of","different","types","of","group","tracks.","All","track","objects","inherits","from","AbstractTrack","enforcing","a","common","interface","Mini","Glossary",":","When","I","speak","about","Live.Track.Track","I","speak","about","the","LOM","object","representing","a","track","When","I","speak","about","SimpleTrack","or","AbstractGroupTrack","I’m","talking","about","the","classes","I","defined.","When","I","speak","about","a","group","track,","I","just","mean","a","group","track","in","a","set","(that","is","foldable","and","has","sub_tracks).","Contextual","Explanation","I’ve","created","the","SimpleTrack","class","originally","to","make","handling","tracks","easier","than","with","the","stock","Live.Track.Track","objects","(because","I","can","add","my","listeners,","events,","methods","etc)","and","also","to","get","a","stronger","typing","experience.","Conceptually","they","are","simple","and","a","one","to","one","mapping","to","a","track.","But","what","I","really","wanted","when","I","started","the","script","was","to","be","able","to","manipulate","group","tracks","as","if","they","were","a","non","group","track","(e.g.","arming","/","soloing","/","recording","etc","…).","This","is","because","I","wanted","to","record","midi","and","audio","in","a","group","track","at","the","same","track,","the","group","track","being","actually","one","instrument.","So","I","created","the","AbstractGroupTrack","which","is","a","mapping","from","a","group","track.","But","because","all","my","tracks","are","already","mapped","to","a","SimpleTrack","they","are","indeed","mapped","from","a","SimpleTrack.","and","AbstractGroupTrack.base_track","is","this","SimpleTrack","while","SimpleTrack.abstract_group_track","is","the","opposite","relationship.","What","is","conceptual","here","is","that","I’m","creating","a","double","mapping","layer","(iterating","twice","on","the","track","list","on","set","startup).","The","first","layer","is","just","SimpleTrack","creation","and","is","straightforward.","The","second","layer","is","the","AbstractGroupTrack","creation","and","is","not","as","straightforward.","I’m","effectively","mapping","all","group","tracks","of","the","set","into","subclasses","of","AbstractGroupTrack.","But","I’m","still","keeping","the","SimpleTrack","mapping,","it","is","necessary","for","several","reasons,","notably","that","the","SimpleTrack","handles","access","to","the","underlying","LOM","objects.","The","only","thing","complicated","here","is","that","each","group","track","is","both","a","SimpleTrack","and","an","AbstractGroupTrack",".","Both","objects","can","access","the","other","and","that’s","part","of","the","glue","between","the","2","layers.","One","touchy","thing","with","this","setup","is","for","example","if","we","have","nested","group","tracks","then","we","will","effectively","have","the","two","layer","setup","with","SimpleTrack","group","track","objects","having","SimpleTrack","sub","tracks","and","AbstractGroupTrack","having","either","AbstractGroupTrack","or","SimpleTrack","sub","tracks.","So","it","means","that","when","accessing","an","AbstractGroupTrack","sub","tracks","we","have","either","classes","(so","actually",":","List[AbstractTrack]).","But","when","accessing","the","same","Live","track","from","its","SimpleTrack","object","the","sub_tracks","are",":","List[SimpleTrack].","It’s","a","bit","convoluted","but","for","me","it","means","AbstractTracks","are","the","interface","to","the","controller","and","what","the","interface","sees.","They","handle","logic","but","leave","implementation","details","to","the","lower","SimpleTracks","layer.","The","lower","layer","handles","all","the","tiny","lom","logic","and","listeners","and","emit","their","own","events","when","necessary.","Details",":","SimpleTrack:","one","to","one","mapping","with","Live.Track.Track.","Subclassed","by","AbstractGroupTrack","(abstract)",":","One","to","one","on","a","Live","group","track","(SimpleTrack)","and","handling","actions","on","sub_tracks.","Taking","into","account","sub_tracks","can","be","thought","of","as","a","one","to","many","mapping","with","SimpleTrack.","Sub","tracks","of","an","AbstractGroupTrack","can","access","their","SimpleTrack","group_track","by","self.group_track","(as","any","grouped","track)","and","abstract_group_track","(AbstractGroupTrack)","by","self.abstract_group_track.","Subclassed","by","SimpleGroupTrack",":","A","group","track","with","no","specific","behavior.","ExternalSynthTrack.","Allows","recording","an","external","synth","easily:","abstraction","track","wrapping",":","A","midi","SimpleTrack","An","audio","SimpleTrack","AbstractTrack",":","top","of","the","inheritance","hierarchy","for","any","track","object","(and","an","abstract","class).","This","class","groups","all","common","attributes","and","methods","that","are","indeed","the","interface","of","any","track","object.","Including",":","self.base_track","is","always","the","track","itself","or","the","group_track","in","the","case","of","an","AbstractGroupTrack","self._track","is","the","underlying","Live.Track.Track","object","(and","==","self.base_track._track)","self.group_track","is","the","SimpleTrack","mapping","of","self._track.group_track","self.abstract_group_track","is","the","AbstractGroupTrack","parent","if","it","exists","Global","track","objects","and","lists","SongManager","private","track","lists","Starting","with","a","Live.Track.Track","object,","2","layers","of","abstraction","are","necessary","to","map","the","Live","track","object","to","our","own","track","object:","_live_track_to_simple_track",":","maps","a","Live.Track.Track","to","a","SimpleTrack","object","_simple_track_to_abstract_group_track",":","maps","a","SimpleTrack","to","its","AbstractGroupTrack","(either","from","the","group_track","or","any","of","its","sub_tracks)","With","these","2","lists","we","can","reach","the","right","level","of","abstraction","from","e.g.","Live.Song.Song.selected_track","Track","Lists","in","Song","song.simple_tracks",":","a","List","of","SimpleTrack","(that","is","len(song.simple_tracks)","==","len(tracks)","(in","a","Live","set","except","master","and","return","tracks)","song.abstract_tracks",":","the","top","track","layer","as","they","most","specific","form","(that","is","SimpleTrack","for","lone","tracks","and","AbstractGroupTracks","for","the","group","tracks).","It","also","equals","the","sum","of",":","song.abstract_group_tracks","song.simple_tracks","MINUS","simple_tracks","that","belong","to","an","AbstractGroupTrack","Regarding","my","explanation","above,","the","first","list","is","the","lower","level","and","the","second","a","part","(because","only","top","tracks)","the","higher","level","of","the","2","layers","track","mapping.","Actually","the","controller","sees","both","layers","because","some","controls","are","specific","to","SimpleTrack","objects.","Track","Objects","in","Song","song.selected_track",":","the","selected","SimpleTrack","object","(that","is","self._live_track_to_simple_track[Live.Track.Track]","song.current_track",":","the","most","iconic","property","of","the","script.","It","equals",":","self._simple_track_to_abstract_group_track[song.selected_track]","or","song.selected_track.","And","indeed","always","outputs","the","appropriate","abstraction","level","from","the","currently","selected_track.","This","property","allows","transparent","track","manipulation","from","the","controller","Track,","Clip_slot","and","Clip","generation","Maintaining","state","through","LOM","changes","The","underlying","lom","objects","do","not","change","(even","though","the","index","in","e.g.","\u0026lt;Track.Track","object","at","0x000000009AFAD6C8\u0026gt;)","changes","..).","Moreover","the","_live_ptr","property","on","all","objects","will","stay","the","same.","It","took","me","a","long","time","to","realize","this","simple","fact","god","knows","why.","As","objects","don’t","change","it","is","possible","to","reuse","existing","objects","so","that’s","what","I’m","doing","when","I","have","a","track","change","or","scene","change.","Reusing","all","my","tracks","objects","and","taking","care","of","re","building","my","clip","slots","(e.g.","on","scene","add)","while","reusing","existing","ones.","Like","this","my","state","is","preserved","while","the","set","is","open.","What","happens","on","startup","and","after","tracks","or","scenes","change","NB:","on","tracks","or","scene","change","I’m","reusing","objects","as","stated","above","NB:","everything","is","done","on","tick","0","(synchronous,","nothing","is","deferred)","All","tracks","are","mapped","to","SimpleTracks.","ClipSlots","are","generated","Clips","are","generated","Instrument","activation","states","are","mapped","back","from","the","stale","simple","track","list.","Then","stale","tracks","are","disconnected.","Abstract","group","tracks","are","generated","by","looking","up","track","names","and","sub_tracks","disposition","(ExternalSynthTrack).","ExternalSynthTrack.__init__","links","audio","and","midi","tracks","During","creation","of","Abstract","group","track","objects,","tracks","are","linked","and","generate","linking","for","5.","ClipSlots","via","ClipSlotSynchronizer","6.","Clips","via","ClipSynchronizer","(handle","by","the","ClipSlotSynchronizer)","abstract_tracks","and","current_track","properties","are","computed","Asynchronous","tasks","and","scheduling","Tl;dr",":","When","the","code","cannot","be","executed","synchronously","(some","LOM","changes","are","asynchronous,","dispatching","keystrokes","and","clicks","is","also","asynchronous","etc","..)","we","need","to","defer","callbacks","to","be","run","later.","There","are","2","ways","to","handle","this",":","either","by","listening","on","LOM","properties","(when","possible)","or","by","delaying","callbacks","using","a","timer.","Here","are","the","2","ways","of","scheduling","asynchronous","tasks","in","the","code",":","The","clean","one","is","to","listen","to","changes","on","the","LOM","by","setting","up","listeners.","It","should","be","used","wherever","it","is","possible","(See","explanations","in","this","doc).","Obviously","this","technique","works","only","when","the","changes","can","be","observed","by","listening","to","observable","properties.","The","other","way","is","to","wait","for","a","constant","duration","instead","of","having","a","reactive","workflow.","This","usually","happens","in","the","following","cases",":","We","cannot","set","up","listeners","on","objects","(some","properties","are","not","listenable)","or","even","the","changes","will","not","be","reflected","in","the","LOM","(e.g.","showing","a","VST","doesn’t","trigger","changes","in","the","LOM).","The","scheduling","does","not","imply","LOM","changes","(e.g.","overcoming","the","changes","cannot","be","triggered","by","notifications)","It","just","seems","easier","to","define","a","duration","in","ms","than","to","setup","some","complicated","listener","pattern","This","second","way","works","by","leveraging","a","timer","loop","given","by","the","Live","API.","It","seems","to","be","the","only","way","possible","as","using","threading.timer","does","not","work","and","is","detailed","in","the","timer","scheduling","following","section.","Using","listeners","Using","listeners","directly","in","this","doc.","This","means","attaching","callbacks","to","listeners","in","some","way","and","implies","setting","at","least","one","callback","variable.","This","method","is","not","used","in","the","script.","Using","the","Sequence","class","(see","doc","in","code).","**Tl;dr","**:","The","sequence","class","uses","both","scheduling","workflows","(listener","and","timer).","For","the","listener","workflow","it","makes","it","easier","to","work","with","listeners","by","handling","the","callback","registration","on","the","listeners","themselves","and","also","makes","the","syntax","cleaner","when","splitting","a","functionality","in","different","asynchronous","steps(reducing","boilerplate","code).","This","is","possible","when","using","the","p0_subject_slot","decorator","instead","of","the","subject_slot","framework","decorator.","I","like","this","class","a","lot","^^.","Part","of","this","is","probably","already","obsolete","as","of","Live","11","because","now","we","might","use","asyncio.","The","Sequence","class","Replacement","of","the","_Framework","Task","as","it","does","not","seem","to","allow","variable","timeouts","like","triggers","from","listeners.","A","Sequence","usually","represents","a","number","of","statements","(usually","a","whole","method)","and","a","SequenceStep","one","statement","A","SequenceStep","is","very","often","a","function","call","that","could","return","a","Sequence.","That","is","Sequences","can","be","nested","allowing","deep","asynchronous","function","calls.","A","Sequence","should","never","be","passed","to","the","called","code","but","instead","the","called","code","should","return","it\u0026rsquo;s","own","sequence","to","be","appended","(and","executed)","to","the","calling","one.","Attention:","The","called","code","is","gonna","be","called","synchronously,","any","data","lookup","(e.g.","on","Live","API)","is","gonna","be","computed","at","sequence","instantiation","time","and","not","at","sequence","runtime.","If","you","don\u0026rsquo;t","want","this","behavior","to","happen,","wrap","your","lookup","calls","in","a","step.","Ideally,","an","asynchronous","method","should","wrap","all","it\u0026rsquo;s","statements","in","a","sequence","and","do","lookups","in","lambda","functions.","The","code","can","declare","asynchronous","behavior","in","2","ways:","via","wait","which","leverages","Live.Base.Timer","fast","tick","for","tasks","where","we","have","a","rough","idea","of","the","delay","and","guess","without","too","much","hassle","(see","below)","via","the","on_complete","argument","that","defers","the","completion","of","the","step","until","a","condition","is","satisfied.","This","condition","can","be","either",":","a","simple","callable","returning","a","bool",":","in","this","case","an","exponential","polling","is","setup","with","a","timeout","a","CallbackDescriptor","decorated","function","(a","function","decorated","by","@p0_subject_slot","or","@has_callback_queue)",":","the","step","executes","when","the","function","is","called","next","be","it","by","Live","listener","system","or","by","direct","call.","This","is","the","best","part","because","it","allows","us","to","react","to","the","execution","of","Live","listeners","or","even","our","own","listeners.","Thus","being","a","shortcut","to","define","yet","another","listener","on","a","subject.","To","be","clearer","it","is","equivalent","to","defining","a","method","listening","on","a","subject","(a","listener)","that","would","call","back","the","sequence","when","executed.","Example","usage","1","2","3","4","5","6","def","duplicate_track(self,","index):","#","type:","(Song,","int)","-\u0026gt;","Sequence","seq","=","Sequence()","#","instantiate","the","Sequence","class","#","add","the","callable","to","the","sequence","seq.add(partial(self._song.duplicate_track,","index),","complete_on=self.parent.songManager.tracks_listener)","#","declare","the","completion","step","return","seq.done()","#","call","seq.done","to","trigger","the","sequence","A","sequence","step","should","always","define","its","completion","step","and","not","expect","the","next","step","to","handle","any","timeout","or","checks.","Like","this","any","step","can","always","be","assured","that","it","executes","after","the","previous","one","has","succeeded","or","failed","(thus","ending","the","sequence).","After","creating","a","sequence","by","e.g.","seq","=","Sequence()","you","should","always","call","seq.done()","to","start","the","sequence","execution.","If","not","the","sequence","is","not","going","to","be","called","and","an","exception","will","be","thrown","at","the","next","tick.","Conditional","execution","Conditional","execution","of","steps","is","available","via","do_if","and","do_if_not","which","can","be","any","argument","to","Sequence.add","The","condition","is","executed","before","the","main","callable","and","can","bypass","the","step","depending","on","the","result","return_if","and","return_if_not","are","similar","but","will","end","the","enclosing","sequence","early","instead.","These","two","callables","are","going","to","be","executed","before","the","main","callable","which","can","therefore","not","be","called","This","is","rarely","needed","but","if","needed","it\u0026rsquo;s","better","to","put","return_if","or","return_if_not","in","an","empty","step","(without","a","callable)","to","make","things","clearer","Using","timers","They","are","(to","my","knowledge)","2","ways","of","scheduling","asynchronous","tasks","via","timers","using","the","Live","API.","Both","leverage","a","timer","that","runs","every","n","millisecond","so","that","a","task","(a","callable)","can","not","be","called","faster","than","this","interval","Via","ControlSurface.schedule_message","The","tick","interval","is","about","100ms","+-","20ms","(roughly)","called","via","ControlSurface.schedule_message(delay_in_ticks:","int,","callable:","Callable)","This","seem","to","be","the","historical","way","of","scheduling","tasks","using","timers","and","the","easiest","way","also","as","the","tasks","and","timing","management","is","handled","by","the","framework","Via","Live.Base.Timer","The","tick","interval","is","much","shorter","(around","17ms","+-","3ms","on","my","system)","This","way","the","handling","of","the","task","queue","needs","to","be","done","by","the","script","(not","so","complicated)","This","technique","is","used","by","the","push2","code","and","also","by","a","famous","remote","script","As","the","2nd","method","is","the","fastest","that’s","what","I","used.","The","numbers","associated","to","wait","parameters","always","refer","to","this","tick","interval.","Changes","cannot","be","triggered","by","notification","error","This","infamous","error","appears","when","we","want","to","apply","modifications","to","the","LOM","in","the","same","tick","as","we","received","a","notification","(that","is","a","listener","was","triggered","somewhere).","Not","all","changes","to","the","LOM","trigger","this","error,","only","certain","property","changes.","It","is","quite","boring","and","there","might","be","a","clean","solution","to","handling","this.","I","didn’t","find","it","and","so","there","are","a","lot","of","places","where","I","defer","changes","by","using","stuff","like","the","@defer","decorator","on","listeners","or","self.parent.defer","methods.","This","just","delays","the","callable","execution","to","the","next","tick.","It","is","inconvenient","for","2","reasons",":","First","it","means","wrapping","assignments","in","syntax","of","the","type","partial(settattr,","…))","which","is","not","clear","and","not","as","well","understood","by","pycharm","as","normal","assignments","or","method","calls.","Second","it","is","not","so","clear","why","there","are","all","these","defers","because","deferring","can","be","done","for","other","reasons","as","well","Potential","solution","The","solution","is","to","defer","all","actions","done","after","a","listener.","Adding","a","defer","in","the","@p0_subject_slot","would","be","a","start.","I","didn’t","do","this","because","I","used","to","work","with","the","100","ms","tick","and","didn’t","want","to","slow","down","all","the","code","for","this","trivial","issue,","as","the","deferring","could","potentially","add","up","to","more","than","one","tick","and","noticeably","slow","down","the","interface","for","complex","tasks.","Now","I’m","using","the","faster","Live.Base.Timer","tick","so","it","might","be","a","better","choice","indeed.","Old","Solution",":","I","used","to","use","a","decorator","on","properties","setter","that","would","catch","this","error","and","defer","the","call","to","the","next","tick.","It","worked","perfectly","but","I","stopped","using","it","because","I","didn’t","like","the","fact","that","I","didn’t","know","if","the","property","was","changed","or","not.","Didn’t","cause","any","problems","but","I","thought","it","could","(or","had)","potentially","introduce","subtle","bugs.","**Current","Solution","**:","it","is","not","such","a","big","issue","because","it","doesn’t","happen","often","and","is","very","easy","to","fix.","So","for","now","I’m","just","deferring","stuff.","Also","I’m","always","deferring","callback","execution","when","they","are","attached","to","a","listener.","I’m","usually","setting","@defer","decorator","on","a","method","that","would","trigger","this","error.","I","prefer","putting","it","on","the","topmost","calling","method","instead","of","e.g.","setter.","Interface","and","controls","The","interface","is","exposed","in","the","components/actionGroups","folder.","It","is","targeted","at","my","FaderFox","ec4","which","is","composed","of","16","knobs.","knobs","(or","encoders)","can","send","notes","via","press","or","CC","via","scroll.","Classes","AbstractActionGroup",":","corresponds","to","a","midi","configuration","(or","group)","for","the","16","knobs","(the","ec4","has","many","groups).","A","channel","is","assigned","to","it","and","all","knobs","of","the","group","should","trigger","CC/Notes","on","that","channel","MultiEncoder",":","corresponds","to","a","knob","on","the","EC4","and","is","assigned","a","midi","identifier","(for","cc","or","Note).","As","such,","any","controller","with","configurable","note","/","cc","can","be","used","with","this","interface.","But","the","controller","should","be","configured","to","match","the","script","Midi","ids","and","channels.","The","MultiEncoder","class","handles","difference","“moves”",":","presses","long","presses","scroll","modifiers","(see","below)","Any","of","this","theses","moves","will","trigger","“actions”","(that","is","execute","a","callable)","Modifiers","As","my","beloved","EC4","has","a","little","screen","but","only","16","knobs","I","thought","of","a","way","to","optimize","knobs","by","not","only","mapping","one","knob","to","a","one","button","but","by","using","modifiers.","A","button","can","be","modified","by","one","modifier","only","at","the","moment.","So","a","MultiEncoder","belong","to","1","of","2","categories",":","modifiers",":","we","cannot","attach","actions","to","them","and","they","just","listen","to","presses.","encoders",":","actions","can","be","attached","to","any","of","the","encoder","possible","“moves”","or","to","a","move","with","a","modifier","pressed.","Encoder","as","selected","object","and","modifier","as","verb","This","setup","is","interesting","because","semantically","I","mostly","think","of","modifiers","as","verbs","and","encoders","as","objects","(objects","always","mean","“selected”","object","of","course).","Here","are","the","“object”","encoders","I","defined:","Track","Track","Category","(the","script","allows","us","to","tag","tracks","with","a","category)","Scene","Clip","Song","verbs","(modifiers)","correspond","to","EncoderModifierEnum","Example",":","The","modifier","Play","can","be","applied","to","all","of","the","encoders","listed","and","will","play","/","stop","the","corresponding","object","(and","of","course","it","applies","to","the","selected","object,","e.g.","the","selected","track).","Development","headstart","for","remote","scripting","Editor","Pycharm","of","course.","Autocompletion","Is","done","by","adding","some","folders","as","content","roots.","Adding","decompiled","version","of","framework","or","Ableton","v2","is","really","necessary","as","it","allows","Pycharm","to","make","it’s","autocompletion","magic","Adding","https://github.com/cylab/AbletonLive-API-Stub","as","content","root","will","allow","pycharm","to","enable","auto","completion","on","the","Live","module","Typing","I’m","using","python2.7\u0026rsquo;s","typing","system","and","it","helps","a","lot.","the","typing","module","is","not","available","in","the","Live10","python","build","so","it","is","necessary","to","install","it","locally","and","insert","the","site-packages","folder","in","sys.path","before","anything","else","in","the","__init__.py","Logging","Log","formatting","I","wrote","a","little","PowerShell","script","(in","my","Protocol0-backend","repo","that","filters,","colors","and","formats","Ableton","log","file","with","only","my","script","info","(and","errors).","Works","also","with","my","logging","level","in","the","script.","It","helps","a","good","deal.","Data","model","dump","I","also","have","a","\u0026ldquo;dump\u0026rdquo;","method","that","dumps","the","most","interesting","part","of","my","model","data","to","the","log","file","(to","inspect","the","script","state)","and","is","mapped","to","one","button","of","my","controller.","Testing","Jupyter","notebooks","I","wrote","a","dummy","Live","stub","that","allows","me","to","load","part","of","my","code","in","tests","and","jupyter","notebooks.","A","real","Live","stub","could","be","written","but","I","don\u0026rsquo;t","think","it\u0026rsquo;s","worth","a","shot","as","it","would","need","to","be","quite","complex","to","emulate","real","situations.","Still,","jupyter","is","great","for","small","python","tests.","Pytest","As","for","the","jupyter","notebooks","it","is","possible","to","test","parts","of","the","script","by","using","the","dummy","Live","Stub.","We","can","test","functions","and","classes","that","don’t","interact","too","deeply","with","the","Live","API.","Limited","but","useful.","Wider","tests","can","be","achieved","by","mocking","the","LOM","in","more","detail.","Seems","overkill","as","stated","above."],"description":"","keywords":["Ableton","Ableton Remote Script","Ableton Control Surface Script","Python"],"objectID":"413fa75a2fcda853d8d8c186739f2e04","permalink":"https://lebrunthibault.github.io/post/protocol0-technical-overview/","summary":"Protocol0 Ableton Surface Script technical overview and discussion","title":"Protocol 0 technical overview","toc":"\u003cnav id=\"TableOfContents\"\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\"#object-model\"\u003eObject Model\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#track-classes\"\u003eTrack Classes\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#contextual-explanation\"\u003eContextual Explanation\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#global-track-objects-and-lists\"\u003eGlobal track objects and lists\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#songmanager-private-track-lists\"\u003eSongManager private track lists\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#track-lists-in-song\"\u003eTrack Lists in Song\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#track-objects-in-song\"\u003eTrack Objects in Song\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#track-clip_slot-and-clip-generation\"\u003eTrack, Clip_slot and Clip generation\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#maintaining-state-through-lom-changes\"\u003eMaintaining state through LOM changes\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#what-happens-on-startup-and-after-tracks-or-scenes-change\"\u003eWhat happens on startup and after tracks or scenes change\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#asynchronous-tasks-and-scheduling\"\u003eAsynchronous tasks and scheduling\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#using-listeners\"\u003eUsing listeners\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#the-sequence-class\"\u003eThe Sequence class\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#using-timers\"\u003eUsing timers\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#via-controlsurface-schedule_message\"\u003eVia \u003ccode\u003eControlSurface.schedule_message\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#via-live-base-timer\"\u003eVia \u003ccode\u003eLive.Base.Timer\u003c/code\u003e\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#changes-cannot-be-triggered-by-notification-error\"\u003eChanges cannot be triggered by notification error\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#potential-solution\"\u003ePotential solution\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#interface-and-controls\"\u003eInterface and controls\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#classes\"\u003eClasses\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#modifiers\"\u003eModifiers\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#development\"\u003eDevelopment\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#editor\"\u003eEditor\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#typing\"\u003eTyping\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#logging\"\u003eLogging\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#powershell-formatting\"\u003eLog formatting\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#data-model-dump\"\u003eData model dump\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#testing\"\u003eTesting\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#jupyter-notebooks\"\u003eJupyter notebooks\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#pytest\"\u003ePytest\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n  \u003c/ul\u003e\n\u003c/nav\u003e","url":"/post/protocol0-technical-overview/"},{"content":["This","is","a","structured","list","of","thoughts","about","software","development","and","what","techniques","I","feel","leads","to","strong","code.","I\u0026rsquo;m","focusing","on","the","languages","I\u0026rsquo;ve","used","most",":","Python","and","PHP.","That","is","on","Object","Oriented,","dynamically","typed","languages.","It","has","a","focus","on","what","I","would","call","\u0026ldquo;static","code\u0026rdquo;,","that","is","how","a","codebase","answering","to","a","given","problem","should","look","like","at","release","time.","Not","how","you","get","there","(development","methods,","prototyping","..)","nor","how","to","test","/","release","/","maintain","code.","It\u0026rsquo;s","a","work","in","progress.","Even","though","many","concepts","are","well","known,","I\u0026rsquo;m","writing","them","down","the","way","I","understand","them.","I\u0026rsquo;ve","structured","this","document","as","going","from","lower","level","development","techniques","to","higher","level","concepts","like","design","patterns.","Typing","Made","a","distinction","between","literal","types:","types","as","seen","by","a","type","checker,","logical","types:","types","as","how","they","carry","logic","and","state","structural","types:","interfaces,","how","components","are","structured","at","the","higher","level","of","the","codebase","Literal","types:","type-hints","Using","extensively","language","types","/","type-hinting","possibilities","makes","dynamically","typed","languages","feel","more","a","statically","typed","ones","and","as","such","automatically","detect","a","whole","range","of","bugs","that","would","have","otherwise","arisen","at","runtime.","Compilation","is","replaced","by","type","checkers","static","analysis.","Maybe","as","importantly,","it","makes","the","code","much","easier","to","grasp","at","first","sight","and","feels","like","loosening","the","coupling","between","components","at","the","type","level","(we","don\u0026rsquo;t","need","to","understand","what","a","method","logically","returns","only","what","type","it","returns)","The","editor","should","be","configured","to","error","about","wrong","parameter","types.","Setup","static","analysis","tools","(like","mypy)","with","strict","settings.","They","should","be","integrated","in","the","IDE,","run","as","pre-commit","and","in","the","test","/","deploy","pipeline.","Logical","types:","Data","Transfer","Objects","As","soon","as","the","type","hint","system","does","not","go","deep","enough","or","that","we","need","to","encapsulate","state","we","should","use","Data","Transfer","Objects",".","Make","these","DTO","minimal","and","focused.","Logic","should","be","scarce.","Use","language","constructs","like","python\u0026rsquo;s","decorator","@dataclass.","Never","manipulate","arrays","that","contain","mixed","types","as","keys","or","values.","Use","DTO","/","custom","classes","instead","+","enums.","Never","use","literal","string","as","dictionary","indexes","if","you","later","need","to","subscript","it","directly.","This","violates","DRY,","does","not","play","well","with","IDEs","and","makes","refactoring","painful.","Structural","types",":","interfaces","\u0026amp;","mixins","\u0026ldquo;Code","against","interfaces\u0026rdquo;.","At","a","high","level","the","program","should","look","like","interfaces","interacting","with","each","other","thus","enforcing","the","typing","experience","at","this","level","also.","More","in-depth","explanation","below","DRY","Maybe","the","single","most","important","(and","simplest)","rule","is","to","reduce","(code","/","information","/","logic)","duplication","in","the","codebase","at","the","bar","minimum.","It","has","architectural","as","well","as","technical","implications.","It","is","easier","to","spot","and","correct","than","to","get","right","from","the","start.","Here","again","I\u0026rsquo;ll","go","from","lower","level","(technical)","techniques","to","higher","level","thinking.","Literals","Literal","values","are","the","simplest","dry","violation","to","spot,","especially","string","ones.","They","should","almost","never","happen","Literal","values","(especially","strings)","usually","belong","to","configuration","/","data","and","should","be","banned","from","code","files","containing","logic,","e.g.","services.","Exceptions","to","this","rule","Documentation","Logs","String","arguments","for","external","library","calls","(use","enums","or","class","constants","if","possible)","Hardcoded","filenames","Coding","conventions","(e.g.","the","env","file","is","called",".env)","Where","are","configuration","literals","allowed","Environment","(.env)","for","environment","dependent","variables","and","sensitive","data","Configuration","files","(json,","yaml","..)","for","global","configuration","variable","as","to","centralize","them","and","change","them","easily","Enumerations","They","are","great","and","should","be","used","extensively","whenever","multiple","literals","can","be","grouped","together.","Enums","can","be","grouped","at","the","same","place","in","the","codebase","making","it","easier","to","see","configuration","values","at","a","glance.","They","can","also","be","stored","to","store","more","complex","data","than","an","object","and","in","this","case","getters","should","be","added","to","the","enum","class.","They","can","be","used","with","database","columns.","Class","constants",":","They","can","be","useful","especially","when","prototyping","but","should","not","be","used","when","literals","can","be","stored","in","enums","or","configuration","files.","Private","constants","only","accessed","by","the","class","can","be","useful.","Downsides",":","Public","class","constants","break","encapsulation","and","expose","internals","of","a","class","Using","them","with","inheritance","can","be","confusing","Don\u0026rsquo;t","play","well","with","refactoring","components","in","sub","components.","Don\u0026rsquo;t","necessarily","play","well","with","interfaces","Configuration","data","is","spread","over","many","files","It\u0026rsquo;s","better","to","keep","configuration","away","from","logic","Logic","and","knowledge","duplication","is","present","when","different","part","of","a","system","knows","the","internal","of","other","parts.","It\u0026rsquo;s","called","implicit","knowledge","and","is","closely","related","to","Decoupling","Decoupling","Coupling","is","the","enemy","of","change","because","it","transitively","links","together","things","that","must","change","in","parallel.","Encapsulation","Tell,","don\u0026rsquo;t","ask",":","objects","internals","should","not","be","available","and","known","to","the","client","code","See","also","Law","of","Demeter","The","severity","of","the","encapsulation","is","a","pragmatic","decision","Inheritance","The","canonical","way","to","use","inheritance","is","when","we","have","different","kind","of","classes","related","to","a","parent","class","with","only","minimal","changes","necessary,","and","usually","not","core","logic","changes.","Most","other","kind","of","usages","can","usually","be","replaced","by","a","better","pattern.","The","problems","with","inheritance","Coupling","between","child","and","parent","class",":","any","change","in","the","parent","will","affect","all","child","classes.","using","inheritance","when","using","only","part","of","the","parent","class","interface","is","bad","because","of","the","law","of","demeter.","Semantically","the","parent","class","can","loose","its","(semantical)","meaning","especially","when","the","child","class","partially","uses","the","parent","class.","Not","so","easy","to","swap","logic","in","the","parent","class","if","the","class","internals","are","used","by","the","child","classes.","Code","gets","confusing","as","soon","as","multiple","levels","are","involved,","even","without","considering","multiple","inheritance","Solutions","Interfaces","Delegation","Mixins","Building","interfaces","Law","of","Demeter",":","a","class","should","not","expose","sub","objects","only","a","clean","and","minimal","interface.","See","Wikipedia","Consequence","→","encapsulation.","An","object","should","be","responsible","for","managing","its","own","logic.","State","Logic","and","state","should","not","be","mixed","State","should","be","encapsulated","in","Data","objects","handling","only","minimal","logic","Other","principles","Uniform","access:","hide","the","implementation","details","(see","Encapsulation]).","Python\u0026rsquo;s","@property","Design","Patterns","Finite","State","Machines","or","workflows","Finite","possible","states","with","a","current","state","Each","state","defines","events","(or","transitions)","that","change","the","current","state","and","can","trigger","actions","Simple","to","implement","Centralizes","the","state","transformation","away","from","the","core","logic","Use","an","enum","for","states","Observer","Allows","hooking","inside","of","a","component","without","knowing","none","of","its","logic,","nor","needing","to","modify","its","code.","Just","the","name","/","type","of","the","event","it","produces","is","enough.","Simple","and","strong","but","introduces","coupling","when","the","observers","need","to","register","directly","on","the","observable.","On","events","it","is","the","observable","that","execute","the","observer","methods,","it","can","impact","performance.","Pub","/","Sub","Evolution","of","the","observer",":","the","observer","is","a","consumer","and","the","observable","does","not","know","about","its","consumers.","Deals","well","with","asynchronous","code.","Message","passing","is","decoupled","from","the","sender","code.","Scales","well.","Message","queuing","is","a","special","case","of","pub/sub1","Not","so","easy","to","grasp","at","first","side","as","the","public","/","subscribe","are","done","in","different","places.","Reactive","programming2","Another","way","to","handle","asynchronous","(or","sync)","events","and","queries","is","to","reason","with","streams","Reduces","coupling","and","greatly","reduces","state","Reduces","boilerplate","code","to","handle","loops","and","logic","on","iterables","Push","based","(more","natural","when","reacting","to","events)","Client","-","Service","communication","via","schema","There","is","one","problem","that","arise","when","multiple","components","want","to","talk","together","in","a","system.","It","is","especially","visible","when","exposing","software","functionality","over","an","API",":","The","client","needs","to","know","how","to","contact","the","service.","That","can","include",":","a","protocol,","paths","or","method","names,","parameter","types","etc.","This","means","some","information","about","the","structure","of","the","service","is","duplicated.","In","an","http","API","that","could","be","simply","the","http","verb","and","the","url.","This","problem","is","present","also","inside","a","single","local","codebase","when","a","client","piece","of","software","calls","a","supplier","but","have","subtler","implications.","The","problems","that","arise","include","the","following",":","Information","and","logic","(parameters","validation","/","marshalling)","duplication","The","typing","information","is","lost","when","e.g.","the","2","components","communicate","over","plain","text","or","bytes.","This","weakens","the","system","as","a","whole.","The","refactoring","becomes","less","straightforward","and","bugs","can","creep","in","due","to","the","2","above","reasons.","A","way","to","centralise","the","service","interface","definition","is","to","have","it","available","as","text","e.g.","using","json","schemas,","either","doing","code-first","or","schema-first","development.","These","removes","information","duplication.","Starting","from","a","json","schema","we","can","simply","generate","sdks","for","any","client.","And","use","for","example","decorators","to","expose","the","service","public","interface.","We","get","to",":","Completely","hide","the","communication","part","of","the","code,","be","able","to","switch","protocols,","and","remove","any","reference","to","the","fact","that","we","are","not","using","local","code.","Have","a","typing","experience","approaching","the","one","inside","the","rest","of","the","codebase.","Code","generation","has","the","additional","benefit","of","reducing","the","number","of","moving","parts","in","the","code","even","if","it","can","of","course","be","modified.","Increases","system","decoupling","and","reduce","mental","overhead","ETC","Error","handling","Use","assertions","for","unexpected","conditions",":","at","the","top","of","the","methods","and","catch","/","log","/","report","assertion","bugs","Use","exceptions","for","normal","error","conditions",":","use","inheritance","to","create","an","exceptions","tree.","Prefer","throwing","exceptions","instead","of","returning","null","Bibliography","The","Pragmatic","Programmer,","20th","Anniversary","Edition","Head","First","Design","Patterns,","2nd","Edition","Comparing","Publish-Subscribe","Messaging","and","Message","Queuing\u0026#160;\u0026#x21a9;\u0026#xfe0e;","http://reactivex.io/\u0026#160;\u0026#x21a9;\u0026#xfe0e;"],"description":"","keywords":["Software development","Backend development","Design patterns"],"objectID":"a12df6e17d307d41be8a7312774ef277","permalink":"https://lebrunthibault.github.io/post/software-development-principles/","summary":"My software development techniques notes","title":"Software development techniques","toc":"\u003cnav id=\"TableOfContents\"\u003e\n  \u003cul\u003e\n    \u003cli\u003e\u003ca href=\"#typing\"\u003eTyping\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#literal-types-type-hints\"\u003eLiteral types: type-hints\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#logical-types-data-transfer-objects\"\u003eLogical types: Data Transfer Objects\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#structural-types--interfaces--mixins\"\u003eStructural types : interfaces \u0026amp; mixins\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#dry\"\u003eDRY\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#literals\"\u003eLiterals\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#exceptions-to-this-rule\"\u003eExceptions to this rule\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#where-are-configuration-literals-allowed\"\u003eWhere are configuration literals allowed\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#logic-and-knowledge\"\u003eLogic and knowledge\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#decoupling\"\u003eDecoupling\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#encapsulation\"\u003eEncapsulation\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#inheritance\"\u003eInheritance\u003c/a\u003e\n          \u003cul\u003e\n            \u003cli\u003e\u003ca href=\"#the-problems-with-inheritance\"\u003eThe problems with inheritance\u003c/a\u003e\u003c/li\u003e\n            \u003cli\u003e\u003ca href=\"#solutions\"\u003eSolutions\u003c/a\u003e\u003c/li\u003e\n          \u003c/ul\u003e\n        \u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#building-interfaces\"\u003eBuilding interfaces\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#state\"\u003eState\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#other-principles\"\u003eOther principles\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#design-patterns\"\u003eDesign Patterns\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#finite-state-machines\"\u003eFinite State Machines\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#observer\"\u003eObserver\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#pub--sub\"\u003ePub / Sub\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#reactive-programming2\"\u003eReactive programming\u003c/a\u003e\u003c/li\u003e\n        \u003cli\u003e\u003ca href=\"#client---service-communication-via-schema\"\u003eClient - Service communication via schema\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n    \u003cli\u003e\u003ca href=\"#etc\"\u003eETC\u003c/a\u003e\n      \u003cul\u003e\n        \u003cli\u003e\u003ca href=\"#error-handling\"\u003eError handling\u003c/a\u003e\u003c/li\u003e\n      \u003c/ul\u003e\n    \u003c/li\u003e\n  \u003c/ul\u003e\n\u003c/nav\u003e","url":"/post/software-development-principles/"}]